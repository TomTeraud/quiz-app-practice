<%# locals: { user: @user, api_key: @api_key, key_type: @key_type }%>
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
  <p class="text-yellow-800 font-medium">API Key Currently Set</p>
  <p class="text-sm text-gray-600">Enter a new key below to replace it, or leave blank to keep current.</p>
</div>
<%= form_with model: @api_key, 
              url: update_api_key_user_path(@user, api_type: @key_type.name), 
              method: :patch, 
              class: "contents" do |form| %>

  <% if @api_key.errors.any? %>
    <div class="py-2 px-3 bg-red-50 mb-5 text-red-500 font-medium rounded-lg inline-block">
      <%= @api_key.errors.full_messages.to_sentence %>
    </div>
  <% end %>

  <div class="my-5">
    <%= form.label :new_key, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.password_field :new_key,
        placeholder: @api_key.persisted? ? "Enter new key to update" : "Enter your API key",
        class: "block shadow rounded-md border border-gray-400 outline-none px-3 py-2 mt-2 w-full" %>
  </div>

  <div class="inline">
    <%= form.submit @api_key.persisted? ? "Update API Key" : "Add API Key",
        class: "rounded-lg py-3 px-5 bg-blue-600 text-white inline-block font-medium cursor-pointer" %>

    <%= link_to "Cancel", profile_user_path(@user),
        class: "rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium ml-2" %>

    <% if @api_key.persisted? %>
      <%= form.button "Remove API Key",
          formmethod: :delete,
          formaction: destroy_api_key_user_path(@user, api_type: @key_type.name),
          data: { turbo_confirm: "Are you sure you want to remove this API key?" },
          class: "rounded-lg py-3 px-5 bg-red-600 text-white font-medium ml-2" %>
    <% end %>
  </div>
<% end %>
